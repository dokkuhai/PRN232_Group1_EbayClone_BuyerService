<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Responsive Bootstrap4 Shop Template, Created by Imran Hossain from https://imransdesign.com/">

	<!-- title -->
	<title>Single Product</title>

	<!-- favicon -->
	<link rel="shortcut icon" type="image/png" href="assets/img/favicon.png">
	<!-- google font -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
	<!-- fontawesome -->
	<link rel="stylesheet" href="assets/css/all.min.css">
	<!-- bootstrap -->
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
	<!-- owl carousel -->
	<link rel="stylesheet" href="assets/css/owl.carousel.css">
	<!-- magnific popup -->
	<link rel="stylesheet" href="assets/css/magnific-popup.css">
	<!-- animate css -->
	<link rel="stylesheet" href="assets/css/animate.css">
	<!-- mean menu css -->
	<link rel="stylesheet" href="assets/css/meanmenu.min.css">
	<!-- main style -->
	<link rel="stylesheet" href="assets/css/main.css">
	<!-- responsive -->
	<link rel="stylesheet" href="assets/css/responsive.css">
<style>
.related-item {
    transition: 0.25s ease;
    border-radius: 8px;
}

.related-item:hover {
    transform: translateY(-6px);
    box-shadow: 0 6px 15px rgba(0,0,0,0.12);
}

.related-item img {
    border-radius: 8px;
}

.related-item h3 a:hover {
    color: #ff5e00;
}
.shipping-box, .confidence-box {
    background: #fff;
    padding: 18px;
    border-radius: 8px;
    border: 1px solid #e4e4e4;
    margin-bottom: 16px;
}

.shipping-box h4, .confidence-box h4 {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 15px;
}

.payment-icons img {
    height: 28px;
    margin-right: 8px;
    filter: grayscale(10%);
}

.confidence-box i {
    color: #0055cc;
    margin-right: 6px;
}

</style>

</head>
<body>
	
	<!--PreLoader-->
    <div class="loader">
        <div class="loader-inner">
            <div class="circle"></div>
        </div>
    </div>
    <!--PreLoader Ends-->
	
	<!-- header -->
	<div class="top-header-area" id="sticker">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 col-sm-12 text-center">
					<div class="main-menu-wrap">
						<!-- logo -->
						<div class="site-logo">
							<a href="index.html">
								<img src="assets/img/logo.png" alt="">
							</a>
						</div>
						<!-- logo -->

						<!-- menu start -->
						<nav class="main-menu">
							<ul>
								<li class="current-list-item"><a href="#">Home</a>
									<ul class="sub-menu">
										<li><a href="index.html">Static Home</a></li>
										<li><a href="index_2.html">Slider Home</a></li>
									</ul>
								</li>
								<li><a href="about.html">About</a></li>
								<li><a href="#">Pages</a>
									<ul class="sub-menu">
										<li><a href="404.html">404 page</a></li>
										<li><a href="about.html">About</a></li>
										<li><a href="cart.html">Cart</a></li>
										<li><a href="checkout.html">Check Out</a></li>
										<li><a href="contact.html">Contact</a></li>
										<li><a href="news.html">News</a></li>
										<li><a href="shop.html">Shop</a></li>
									</ul>
								</li>
								<li><a href="news.html">News</a>
									<ul class="sub-menu">
										<li><a href="news.html">News</a></li>
										<li><a href="single-news.html">Single News</a></li>
									</ul>
								</li>
								<li><a href="contact.html">Contact</a></li>
								<li><a href="shop.html">Shop</a>
									<ul class="sub-menu">
										<li><a href="shop.html">Shop</a></li>
										<li><a href="checkout.html">Check Out</a></li>
										<li><a href="single-product.html">Single Product</a></li>
										<li><a href="cart.html">Cart</a></li>
									</ul>
								</li>
								<li>
									<div class="header-icons">
										<a class="shopping-cart" href="cart.html"><i class="fas fa-shopping-cart"></i></a>
										<a class="mobile-hide search-bar-icon" href="#"><i class="fas fa-search"></i></a>
									</div>
								</li>
							</ul>
						</nav>
						<a class="mobile-show search-bar-icon" href="#"><i class="fas fa-search"></i></a>
						<div class="mobile-menu"></div>
						<!-- menu end -->
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end header -->

	<!-- search area -->
	<div class="search-area">
  <div class="container">
    <div class="row">
      <div class="col-lg-12">
        <span class="close-btn"><i class="fas fa-window-close"></i></span>
        <div class="search-bar">
          <div class="search-bar-tablecell">
            <h3>Search For:</h3>
            <input id="search-input" type="text" placeholder="Keywords">
            <button id="search-btn" type="button">Search <i class="fas fa-search"></i></button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

	<!-- end search arewa -->
	
	<!-- breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
						<p>See more Details</p>
						<h1>Single Product</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end breadcrumb section -->

	<!-- single product -->
	<div class="single-product mt-150 mb-150">
		<div class="container">
			<div class="row">
				<div class="col-md-5">
					<div class="single-product-img">
						<img src="assets/img/products/product-img-5.jpg" alt="">
					</div>
				</div>
				<div class="single-product-content">
    <h3 id="p-title">Loading...</h3>
    <p class="single-product-pricing"><span>Price</span> <span id="p-price">0</span></p>

    <p id="p-description">...</p>

    <div class="single-product-form">
        <form>
            <input type="number" placeholder="0">
        </form>
        <a href="cart.html" class="cart-btn">
            <i class="fas fa-shopping-cart"></i> Add to Cart
        </a>

        <p><strong>Category:</strong> <span id="p-category"></span></p>

        <!-- ADDED -->
        <p><strong>Seller:</strong> <span id="seller-name"></span></p>

        <!-- ADDED -->
        <p><strong>In Stock:</strong> <span id="stock-qty"></span></p>

        <!-- ADDED -->
        <p><strong>Rating:</strong> <span id="avg-rating"></span></p>
		<p><strong>Type:</strong> <span id="product-type"></span></p>

<!-- Nếu bạn muốn hiện ngày kết thúc đấu giá -->
        <p><strong>Auction Ends:</strong> <span id="auction-end"></span></p>


        <!-- ADDED -->
        <div><strong>Coupons:</strong>
            <ul id="coupon-list"></ul>
        </div>

        <!-- ADDED -->
        <div><strong>Reviews:</strong>
            <ul id="review-list"></ul>
        </div>
    </div>

    <h4>Share:</h4>
    <ul class="product-share">
        <li><a href=""><i class="fab fa-facebook-f"></i></a></li>
        <li><a href=""><i class="fab fa-twitter"></i></a></li>
        <li><a href=""><i class="fab fa-google-plus-g"></i></a></li>
        <li><a href=""><i class="fab fa-linkedin"></i></a></li>
    </ul>
</div>

			</div>
		</div>
	</div>
	<!-- end single product -->

	<!-- more products -->
	<div class="more-products mb-150">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="section-title">	
						<h3><span class="orange-text">Related</span> Products</h3>
						<p>Display related product.</p>
					</div>
				</div>
			</div>
			<div class="row" id="related-products"></div>

		</div>
	</div>
	<div class="shipping-box mt-4">
<h4>Shipping:</h4>
<div id="shipping-info" class="mb-3"></div>

    <div class="payment-icons mt-3">
        <img src="https://th.bing.com/th/id/OIP.vRQZ8vcw73umQSZ0Pg45HgHaFj?w=240&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1">
        <img src="https://th.bing.com/th/id/OIP._8BbSAJ5rW8jQVnJPmo3qgHaHa?w=152&h=180&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1">
        <img src="https://th.bing.com/th?q=Visa+Card+Icon&w=120&h=120&c=1&rs=1&qlt=70&o=7&cb=1&pid=InlineBlock&rm=3&ucfimg=1&mkt=en-WW&cc=VN&setlang=en&adlt=moderate&t=1&mw=247">
        <img src="https://th.bing.com/th/id/OIP.4pi_kYxf7wRDRjkxQLyUsAHaEK?w=331&h=186&c=7&r=0&o=7&cb=ucfimg2&pid=1.7&rm=3&ucfimg=1">
    </div>
</div>
<div class="confidence-box mt-4">
    <h4>Shop with confidence</h4>

    <p>
        <i class="fas fa-badge-check"></i> 
        <strong>Top Rated Plus</strong><br>
        Top rated seller, fast shipping, and free returns. 
        <a href="#">Learn more</a>
    </p>

    <p>
        <i class="fas fa-shield-alt"></i>
        <strong>Money Back Guarantee</strong><br>
        Get the item you ordered or your money back.
        <a href="#">Learn more</a>
    </p>
</div>

	<!-- end more products -->

	<!-- logo carousel -->
	<div class="logo-carousel-section">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="logo-carousel-inner">
						<div class="single-logo-item">
							<img src="assets/img/company-logos/1.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="assets/img/company-logos/2.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="assets/img/company-logos/3.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="assets/img/company-logos/4.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="assets/img/company-logos/5.png" alt="">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end logo carousel -->

	<!-- footer -->
	<div class="footer-area">
		<div class="container">
			<div class="row">
				<div class="col-lg-3 col-md-6">
					<div class="footer-box about-widget">
						<h2 class="widget-title">About us</h2>
						<p>Ut enim ad minim veniam perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae.</p>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="footer-box get-in-touch">
						<h2 class="widget-title">Get in Touch</h2>
						<ul>
							<li>34/8, East Hukupara, Gifirtok, Sadan.</li>
							<li>support@fruitkha.com</li>
							<li>+00 111 222 3333</li>
						</ul>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="footer-box pages">
						<h2 class="widget-title">Pages</h2>
						<ul>
							<li><a href="index.html">Home</a></li>
							<li><a href="about.html">About</a></li>
							<li><a href="services.html">Shop</a></li>
							<li><a href="news.html">News</a></li>
							<li><a href="contact.html">Contact</a></li>
						</ul>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="footer-box subscribe">
						<h2 class="widget-title">Subscribe</h2>
						<p>Subscribe to our mailing list to get the latest updates.</p>
						<form action="index.html">
							<input type="email" placeholder="Email">
							<button type="submit"><i class="fas fa-paper-plane"></i></button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end footer -->
	
	<!-- copyright -->
	<div class="copyright">
		<div class="container">
			<div class="row">
				<div class="col-lg-6 col-md-12">
					<p>Copyrights &copy; 2019 - <a href="https://imransdesign.com/">Imran Hossain</a>,  All Rights Reserved.<br>
						Distributed By - <a href="https://themewagon.com/">Themewagon</a>
					</p>
				</div>
				<div class="col-lg-6 text-right col-md-12">
					<div class="social-icons">
						<ul>
							<li><a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-twitter"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-instagram"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-linkedin"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-dribbble"></i></a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end copyright -->
	
	<!-- jquery -->
	<script src="assets/js/jquery-1.11.3.min.js"></script>
	<!-- bootstrap -->
	<script src="assets/bootstrap/js/bootstrap.min.js"></script>
	<!-- count down -->
	<script src="assets/js/jquery.countdown.js"></script>
	<!-- isotope -->
	<script src="assets/js/jquery.isotope-3.0.6.min.js"></script>
	<!-- waypoints -->
	<script src="assets/js/waypoints.js"></script>
	<!-- owl carousel -->
	<script src="assets/js/owl.carousel.min.js"></script>
	<!-- magnific popup -->
	<script src="assets/js/jquery.magnific-popup.min.js"></script>
	<!-- mean menu -->
	<script src="assets/js/jquery.meanmenu.min.js"></script>
	<!-- sticker js -->
	<script src="assets/js/sticker.js"></script>
	<!-- main js -->
	<script src="assets/js/main.js"></script>
<script>
// =====================
// FIXED API DOMAIN 
// =====================
const baseUrl = "https://ebay.dokkuhai.dpdns.org";
const apiBaseUrl = `${baseUrl}/api/Product/`;

// Get ID product từ URL
const params = new URLSearchParams(window.location.search);
const productId = params.get("id") || 1;


// =====================
// LOAD PRODUCT DETAILS
// =====================
async function loadProduct() {
    try {
        const res = await fetch(apiBaseUrl + productId);
        if (!res.ok) throw new Error("Cannot load product");

        const product = await res.json();
        console.log("Product:", product);

        // ----- Chuẩn hóa key (đề phòng OData/JSON) -----
        const name = product.Title ?? product.title;
        const price = product.Price ?? product.price;
        const desc = product.Description ?? product.description;
        const img = product.Images ?? product.images;
        const seller = product.Seller ?? product.seller;
        const inventories = product.Inventories ?? product.inventories;
        const coupons = product.Coupons ?? product.coupons;
        const reviews = product.Reviews ?? product.reviews;
        const category = product.Category ?? product.category;
        const categoryId = product.CategoryId ?? product.categoryId;
        const isAuction = product.IsAuction ?? product.isAuction;
        const auctionEndTime = product.AuctionEndTime ?? product.auctionEndTime;

        // -------- IMAGE --------
        const imgUrl = img?.startsWith("http")
            ? img
            : `assets/img/products/${img || "default.jpg"}`;
        document.querySelector(".single-product-img img").src = imgUrl;

        // -------- BASIC INFO --------
        document.getElementById("p-title").textContent = name;
        document.getElementById("p-price").textContent = price + " VND";
        document.getElementById("p-description").textContent = desc;

        // -------- CATEGORY --------
        document.getElementById("p-category").textContent =
            category?.Name ?? category?.name ?? "Unknown";

        // -------- AUCTION --------
        if (isAuction) {
            document.getElementById("product-type").textContent = "Auction Product";

            if (auctionEndTime) {
                const end = new Date(auctionEndTime);
                document.getElementById("auction-end").textContent = end.toLocaleString();
            } else {
                document.getElementById("auction-end").textContent = "Not specified";
            }
        } else {
            document.getElementById("product-type").textContent = "Normal Product";
            document.getElementById("auction-end").textContent = "N/A";
        }

        // -------- SELLER --------
        document.getElementById("seller-name").textContent =
            seller?.Username ?? seller?.username ?? "Unknown Seller";

        // -------- STOCK --------
        document.getElementById("stock-qty").textContent =
            inventories?.length > 0
                ? inventories[0].Quantity ?? inventories[0].quantity
                : "N/A";

        // -------- COUPONS --------
        const couponList = document.getElementById("coupon-list");
        couponList.innerHTML = "";
        if (coupons?.length > 0) {
            coupons.forEach(c => {
                couponList.innerHTML += `<li>${c.Code ?? c.code} - ${c.DiscountPercent ?? c.discountPercent}%</li>`;
            });
        } else {
            couponList.innerHTML = "<li>No coupons available</li>";
        }

        // -------- REVIEWS --------
        const reviewList = document.getElementById("review-list");
        reviewList.innerHTML = "";
        if (reviews?.length > 0) {
            reviews.forEach(r => {
                reviewList.innerHTML += `<li>⭐ ${r.Rating ?? r.rating}/5 - ${r.Comment ?? r.comment}</li>`;
            });
        } else {
            reviewList.innerHTML = "<li>No reviews yet</li>";
        }

        // -------- AVG RATING --------
        let avgRating = 0;
        if (reviews?.length > 0) {
            const total = reviews.reduce((sum, r) => sum + (r.Rating ?? r.rating), 0);
            avgRating = (total / reviews.length).toFixed(1);
        }

        document.getElementById("avg-rating").textContent =
            reviews?.length > 0
                ? `${avgRating} / 5 ⭐ (${reviews.length} reviews)`
                : "No ratings yet";
        renderExtraSections(product);

        // -------- RELATED PRODUCTS --------
        loadRelatedProducts(categoryId, product.Id ?? product.id);

    } catch (err) {
        console.error("❌ Error loading product:", err);
    }
}
function renderExtraSections(product) {
    /* ====== SHIPPING INFO ====== */
    const shippingBox = document.getElementById("shipping-info");

    // Lấy shipping info từ order
    let ship = null;

    if (product.orderItems?.length > 0) {
        for (let oi of product.orderItems) {
            if (oi.order?.shippingInfos?.length > 0) {
                ship = oi.order.shippingInfos[0];
                break;
            }
        }
    }

    if (ship) {
        shippingBox.innerHTML = `
            <p><strong>Carrier:</strong> ${ship.carrier}</p>
            <p><strong>Status:</strong> ${ship.status}</p>
            <p><strong>Tracking:</strong> ${ship.trackingNumber}</p>
            <p><strong>Estimated Arrival:</strong>
                ${new Date(ship.estimatedArrival).toLocaleDateString()}
            </p>
        `;
    } else {
        // FALLBACK
        const min = new Date(Date.now() + 7 * 86400000);
        const max = new Date(Date.now() + 21 * 86400000);

        shippingBox.innerHTML = `
            <p><strong>Carrier:</strong> Standard Shipping</p>
            <p><strong>Delivery:</strong>
                Estimated between 
                <b>${min.toDateString()}</b> and
                <b>${max.toDateString()}</b>
            </p>
        `;
    }
}


// ============================
// LOAD RELATED PRODUCTS
// ============================
// ============================
// LOAD RELATED PRODUCTS (FINAL)
// ============================
async function loadRelatedProducts(categoryId, currentProductId) {
    try {
        const res = await fetch(`${baseUrl}/api/Product`);
        const data = await res.json();

        const list = Array.isArray(data) ? data : (data.value ?? []);

        const related = list.filter(p =>
            (p.categoryId ?? p.CategoryId) === categoryId &&
            (p.id ?? p.Id) !== currentProductId
        );

        const container = document.getElementById("related-products");
        container.innerHTML = "";

        if (related.length === 0) {
            container.innerHTML = "<p>No related products found.</p>";
            return;
        }

        related.slice(0, 3).forEach(p => {
            const id = p.id ?? p.Id;
            const img = p.images ?? p.Images ?? "";
            const name = p.title ?? p.Title ?? "Unnamed";
            const price = p.price ?? p.Price ?? "N/A";

            const imgUrl = img.startsWith("http")
                ? img
                : `https://th.bing.com/th/id/OIP.ipTpmWrouGNDkLY582e2hQHaEK?w=294&h=180&c=7&r=0&o=7&cb=ucfimg2&dpr=1.3&pid=1.7&rm=3&ucfimg=1"}`;

            container.insertAdjacentHTML(
                "beforeend",
                `
                <div class="col-lg-4 col-md-6 text-center">
                    <div class="single-product-item related-item">
                        <div class="product-image">
                            <a href="single-product.html?id=${id}">
                                <img src="${imgUrl}" alt="${name}">
                            </a>
                        </div>
                        <h3>
							<a href="single-product.html?id=${id}" style="text-decoration:none;color:#333;">
								${name}
							</a>
						</h3>
                        <p class="product-price">${price} VND</p>
                        <a href="single-product.html?id=${id}" class="cart-btn">
                            <i class="fas fa-eye"></i> View
                        </a>
                    </div>
                </div>
                `
            );
        });

    } catch (err) {
        console.error("❌ Error loading related products:", err);
    }
}


document.addEventListener("DOMContentLoaded", loadProduct);
</script>

</body>

</html>
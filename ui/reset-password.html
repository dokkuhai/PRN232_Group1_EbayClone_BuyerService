<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Reset Password</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<style>
		body {
			display: flex;
			height: 100vh;
			justify-content: center;
			align-items: center;
			background: #f8f9fa;
		}

		.card {
			/* === SỬA RESPONSIVE === */
			max-width: 380px;
			/* Giới hạn độ rộng tối đa */
			width: 100%;
			/* Chiếm 100% chiều rộng cha */
			margin: 0 1rem;
			/* Thêm khoảng đệm 2 bên trên màn hình nhỏ */
			/* ======================= */

			border-radius: 12px;
			box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
		}
	</style>
</head>

<body>
	<div class="card p-4">
		<h4 class="text-center mb-3 text-primary">Reset Password</h4>

		<div class="mb-3">
			<label class="form-label">New Password</label>
			<input type="password" id="password" class="form-control" required>
		</div>

		<div class="mb-3">
			<label class="form-label">Confirm Password</label>
			<input type="password" id="confirm" class="form-control" required>
		</div>

		<button class="btn btn-success w-100" id="btnReset">Update Password</button>

		<p id="message" class="text-center mt-3"></p>
	</div>

	<script>
		function getTokenFromUrl() {
			const params = new URLSearchParams(window.location.search);
			return params.get("token");
		}

		document.getElementById("btnReset").addEventListener("click", async () => {
			const password = document.getElementById("password").value;
			const confirm = document.getElementById("confirm").value;
			const msg = document.getElementById("message");
			msg.innerText = "";

			if (!password || !confirm) {
				msg.innerText = "⚠️ Please fill in both fields."; // Thêm check
				msg.className = "text-danger text-center";
				return;
			}

			if (password !== confirm) {
				msg.innerText = "⚠️ Passwords do not match."; // Đã dịch
				msg.className = "text-danger text-center";
				return;
			}

			const token = getTokenFromUrl();
			if (!token) {
				msg.innerText = "❌ Invalid or expired link."; // Đã dịch
				msg.className = "text-danger text-center";
				return;
			}

			try {
				const res = await fetch("https://localhost:7020/api/User/reset-password", {
					method: "POST",
					headers: { "Content-Type": "application/json" },
					body: JSON.stringify({ token, newPassword: password })
				});

				if (res.ok) {
					msg.innerText = "✅ Password reset successfully. You can now log in."; // Đã dịch
					msg.className = "text-success text-center";
					// Tùy chọn: Vô hiệu hóa nút bấm và input sau khi thành công
					document.getElementById("btnReset").disabled = true;
				} else {
					// Cải thiện: Đọc lỗi từ API nếu có
					let errorMsg = "❌ Invalid or expired token."; // Mặc định
					try {
						const data = await res.json();
						if (data && data.message) {
							errorMsg = "❌ " + data.message;
						}
					} catch (e) { /* Bỏ qua nếu không parse được JSON */ }

					msg.innerText = errorMsg; // Đã dịch
					msg.className = "text-danger text-center";
				}
			} catch (err) {
				msg.innerText = "❌ Server connection error."; // Đã dịch
				msg.className = "text-danger text-center";
			}
		});
	</script>
</body>

</html>
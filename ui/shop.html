<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Responsive Bootstrap4 Shop Template, Created by Imran Hossain from https://imransdesign.com/">

	<!-- title -->
	<title>Shop</title>

	<!-- favicon -->
	<link rel="shortcut icon" type="image/png" href="assets/img/favicon.png">
	<!-- google font -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Poppins:400,700&display=swap" rel="stylesheet">
	<!-- fontawesome -->
	<link rel="stylesheet" href="assets/css/all.min.css">
	<!-- bootstrap -->
	<link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
	<!-- owl carousel -->
	<link rel="stylesheet" href="assets/css/owl.carousel.css">
	<!-- magnific popup -->
	<link rel="stylesheet" href="assets/css/magnific-popup.css">
	<!-- animate css -->
	<link rel="stylesheet" href="assets/css/animate.css">
	<!-- mean menu css -->
	<link rel="stylesheet" href="assets/css/meanmenu.min.css">
	<!-- main style -->
	<link rel="stylesheet" href="assets/css/main.css">
	<!-- responsive -->
	<link rel="stylesheet" href="assets/css/responsive.css">
<style>
  select.form-select {
    float: right;
    border-radius: 8px;
    padding: 6px 10px;
  }
  
</style>

</head>
<body>
	
	<!--PreLoader-->
    <div class="loader">
        <div class="loader-inner">
            <div class="circle"></div>
        </div>
    </div>
    <!--PreLoader Ends-->
	
	<!-- header -->
	<div class="top-header-area" id="sticker">
		<div class="container">
			<div class="row">
				<div class="col-lg-12 col-sm-12 text-center">
					<div class="main-menu-wrap">
						<!-- logo -->
						<div class="site-logo">
							<a href="index.html">
								<img src="assets/img/logo.png" alt="">
							</a>
						</div>
						<!-- logo -->

						<!-- menu start -->
						<nav class="main-menu">
							<ul>
								<li class="current-list-item"><a href="#">Home</a>
									<ul class="sub-menu">
										<li><a href="index.html">Static Home</a></li>
										<li><a href="index_2.html">Slider Home</a></li>
									</ul>
								</li>
								<li><a href="about.html">About</a></li>
								<li><a href="#">Pages</a>
									<ul class="sub-menu">
										<li><a href="404.html">404 page</a></li>
										<li><a href="about.html">About</a></li>
										<li><a href="cart.html">Cart</a></li>
										<li><a href="checkout.html">Check Out</a></li>
										<li><a href="contact.html">Contact</a></li>
										<li><a href="news.html">News</a></li>
										<li><a href="shop.html">Shop</a></li>
									</ul>
								</li>
								<li><a href="news.html">News</a>
									<ul class="sub-menu">
										<li><a href="news.html">News</a></li>
										<li><a href="single-news.html">Single News</a></li>
									</ul>
								</li>
								<li><a href="contact.html">Contact</a></li>
								<li><a href="shop.html">Shop</a>
									<ul class="sub-menu">
										<li><a href="shop.html">Shop</a></li>
										<li><a href="checkout.html">Check Out</a></li>
										<li><a href="single-product.html">Single Product</a></li>
										<li><a href="cart.html">Cart</a></li>
									</ul>
								</li>
								<li>
									<div class="header-icons">
										<a class="shopping-cart" href="cart.html"><i class="fas fa-shopping-cart"></i></a>
										<a class="mobile-hide search-bar-icon" href="#"><i class="fas fa-search"></i></a>
									</div>
								</li>
							</ul>
						</nav>
						<a class="mobile-show search-bar-icon" href="#"><i class="fas fa-search"></i></a>
						<div class="mobile-menu"></div>
						<!-- menu end -->
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end header -->

	<!-- search area -->
	<div class="search-area">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<span class="close-btn"><i class="fas fa-window-close"></i></span>
					<div class="search-bar">
						<div class="search-bar-tablecell">
							<h3>Search For:</h3>
							<input type="text" placeholder="Keywords">
							<button type="submit">Search <i class="fas fa-search"></i></button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end search arewa -->
	
	<!-- breadcrumb-section -->
	<div class="breadcrumb-section breadcrumb-bg">
		<div class="container">
			<div class="row">
				<div class="col-lg-8 offset-lg-2 text-center">
					<div class="breadcrumb-text">
						<p>Ebay</p>
						<h1>Shop</h1>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end breadcrumb section -->

	<!-- products -->
	<div class="product-section mt-150 mb-150">
		<div class="container">
			<div class="row product-lists">
				<div class="col-lg-4 col-md-6 text-center strawberry">
					<div class="single-product-item">
						<div class="product-image">
							<a href="single-product.html"><img src="assets/img/products/product-img-1.jpg" alt=""></a>
						</div>
						<h3>Strawberry</h3>
						<p class="product-price"><span>Per Kg</span> 85$ </p>
						<a href="cart.html" class="cart-btn"><i class="fas fa-shopping-cart"></i> Add to Cart</a>
					</div>
				</div>
				<div class="col-lg-4 col-md-6 text-center berry">
					<div class="single-product-item">
						<div class="product-image">
							<a href="single-product.html"><img src="assets/img/products/product-img-2.jpg" alt=""></a>
						</div>
						<h3>Berry</h3>
						<p class="product-price"><span>Per Kg</span> 70$ </p>
						<a href="cart.html" class="cart-btn"><i class="fas fa-shopping-cart"></i> Add to Cart</a>
					</div>
				</div>
				<div class="col-lg-4 col-md-6 text-center lemon">
					<div class="single-product-item">
						<div class="product-image">
							<a href="single-product.html"><img src="assets/img/products/product-img-3.jpg" alt=""></a>
						</div>
						<h3>Lemon</h3>
						<p class="product-price"><span>Per Kg</span> 35$ </p>
						<a href="cart.html" class="cart-btn"><i class="fas fa-shopping-cart"></i> Add to Cart</a>
					</div>
				</div>
				<div class="col-lg-4 col-md-6 text-center">
					<div class="single-product-item">
						<div class="product-image">
							<a href="single-product.html"><img src="assets/img/products/product-img-4.jpg" alt=""></a>
						</div>
						<h3>Avocado</h3>
						<p class="product-price"><span>Per Kg</span> 50$ </p>
						<a href="cart.html" class="cart-btn"><i class="fas fa-shopping-cart"></i> Add to Cart</a>
					</div>
				</div>
				<div class="col-lg-4 col-md-6 text-center">
					<div class="single-product-item">
						<div class="product-image">
							<a href="single-product.html"><img src="assets/img/products/product-img-5.jpg" alt=""></a>
						</div>
						<h3>Green Apple</h3>
						<p class="product-price"><span>Per Kg</span> 45$ </p>
						<a href="cart.html" class="cart-btn"><i class="fas fa-shopping-cart"></i> Add to Cart</a>
					</div>
				</div>
				<div class="col-lg-4 col-md-6 text-center strawberry">
					<div class="single-product-item">
						<div class="product-image">
							<a href="single-product.html"><img src="assets/img/products/product-img-6.jpg" alt=""></a>
						</div>
						<h3>Strawberry</h3>
						<p class="product-price"><span>Per Kg</span> 80$ </p>
						<a href="cart.html" class="cart-btn"><i class="fas fa-shopping-cart"></i> Add to Cart</a>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-lg-12 text-center">
					<div class="pagination-wrap">
						<ul>
							<li><a href="#">Prev</a></li>
							<li><a href="#">1</a></li>
							<li><a class="active" href="#">2</a></li>
							<li><a href="#">3</a></li>
							<li><a href="#">Next</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end products -->

	<!-- logo carousel -->
	<div class="logo-carousel-section">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<div class="logo-carousel-inner">
						<div class="single-logo-item">
							<img src="assets/img/company-logos/1.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="assets/img/company-logos/2.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="assets/img/company-logos/3.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="assets/img/company-logos/4.png" alt="">
						</div>
						<div class="single-logo-item">
							<img src="assets/img/company-logos/5.png" alt="">
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end logo carousel -->

	<!-- footer -->
	<div class="footer-area">
		<div class="container">
			<div class="row">
				<div class="col-lg-3 col-md-6">
					<div class="footer-box about-widget">
						<h2 class="widget-title">About us</h2>
						<p>Group 1 SE 1848</p>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="footer-box get-in-touch">
						<h2 class="widget-title">Get in Touch</h2>
						<ul>
							<li>Group 1 </li>
							<li>Leader: Vũ Đức Hải</li>
						</ul>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="footer-box pages">
						<h2 class="widget-title">Pages</h2>
						<ul>
							<li><a href="index.html">Home</a></li>
							<li><a href="about.html">About</a></li>
							<li><a href="services.html">Shop</a></li>
							<li><a href="news.html">News</a></li>
							<li><a href="contact.html">Contact</a></li>
						</ul>
					</div>
				</div>
				<div class="col-lg-3 col-md-6">
					<div class="footer-box subscribe">
						<h2 class="widget-title">Subscribe</h2>
						<p>Subscribe to our mailing list to get the latest updates.</p>
						<form action="index.html">
							<input type="email" placeholder="Email">
							<button type="submit"><i class="fas fa-paper-plane"></i></button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end footer -->
	
	<!-- copyright -->
	<div class="copyright">
		<div class="container">
			<div class="row">
				<div class="col-lg-6 col-md-12">
					<p>Copyrights &copy; 2019 - <a href="https://imransdesign.com/">Imran Hossain</a>,  All Rights Reserved.<br>
						Distributed By - <a href="https://themewagon.com/">Themewagon</a>
					</p>
				</div>
				<div class="col-lg-6 text-right col-md-12">
					<div class="social-icons">
						<ul>
							<li><a href="#" target="_blank"><i class="fab fa-facebook-f"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-twitter"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-instagram"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-linkedin"></i></a></li>
							<li><a href="#" target="_blank"><i class="fab fa-dribbble"></i></a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- end copyright -->
	
	<!-- jquery -->
	<script src="assets/js/jquery-1.11.3.min.js"></script>
	<!-- bootstrap -->
	<script src="assets/bootstrap/js/bootstrap.min.js"></script>
	<!-- count down -->
	<script src="assets/js/jquery.countdown.js"></script>
	<!-- isotope -->
	<script src="assets/js/jquery.isotope-3.0.6.min.js"></script>
	<!-- waypoints -->
	<script src="assets/js/waypoints.js"></script>
	<!-- owl carousel -->
	<script src="assets/js/owl.carousel.min.js"></script>
	<!-- magnific popup -->
	<script src="assets/js/jquery.magnific-popup.min.js"></script>
	<!-- mean menu -->
	<script src="assets/js/jquery.meanmenu.min.js"></script>
	<!-- sticker js -->
	<script src="assets/js/sticker.js"></script>
	<!-- main js -->
	<script src="assets/js/main.js"></script>
<script>
// =====================
// Detect API Base URL
// =====================
let baseUrl = window.location.origin;

// mở bằng file:/// → fallback localhost
if (baseUrl.startsWith("http")) {
    baseUrl = "https://localhost:7020";
}

// nếu deploy domain
if (baseUrl.includes("dokkuhai")) {
    baseUrl = "https://ebay.dokkuhai.dpdns.org";
}

// API chính
const apiUrl = `${baseUrl}/api/Product`;

const container = document.querySelector(".product-lists");
const paginationWrap = document.querySelector(".pagination-wrap ul");

// =====================
// Config
// =====================
let page = 0;
const pageSize = 3;
let totalCount = 0;
let totalPages = 0;

let currentKeyword = "";
let currentSort = "";
let currentCategorySort = "";

// =====================
// Load Products
// =====================
async function loadProducts() {
    try {
        container.innerHTML = "<p>Loading products...</p>";

        const skip = page * pageSize;
        let url = "";

        const isLocal = baseUrl.includes("localhost");

        if (isLocal) {
            // ----- LOCAL ODATA -----
            url = `${apiUrl}?$expand=Category&$count=true&$top=${pageSize}&$skip=${skip}`;

            // tìm kiếm
            if (currentKeyword.trim() !== "") {
                const keyword = currentKeyword.toLowerCase();
                url += `&$filter=contains(tolower(Title),'${keyword}') or contains(tolower(Category/Name),'${keyword}')`;
            }

            // sort theo Category
            if (currentCategorySort !== "") {
                url += `&$orderby=Category/Name ${currentCategorySort}`;
            }
            // sort theo Title/Price
            else if (currentSort !== "") {
                url += `&$orderby=${currentSort}`;
            }

        } else {
            // ----- DEPLOY JSON THUẦN -----
            url = apiUrl;
        }

        const res = await fetch(url);
        if (!res.ok) throw new Error("Fetch failed");
        const rawData = await res.json();

        const data = Array.isArray(rawData) ? rawData : (rawData.value ?? []);

        // ===============================
        // DEPLOY → lọc, sort, paging bằng JS
        // ===============================
        let products = [...data];

        if (!isLocal) {
            // ---- JS FILTER ----
            if (currentKeyword.trim() !== "") {
                const key = currentKeyword.toLowerCase();
                products = products.filter(p =>
                    (p.title ?? "").toLowerCase().includes(key) ||
                    (p.category?.name ?? "").toLowerCase().includes(key)
                );
            }

            // ---- JS SORT ----
            if (currentCategorySort !== "") {
                products.sort((a, b) =>
                    currentCategorySort === "asc"
                        ? (a.category?.name ?? "").localeCompare(b.category?.name ?? "")
                        : (b.category?.name ?? "").localeCompare(a.category?.name ?? "")
                );
            }
            else if (currentSort !== "") {
                const [field, direction] = currentSort.split(" ");

                products.sort((a, b) => {
                    const va = a[field.toLowerCase()];
                    const vb = b[field.toLowerCase()];
                    return direction === "asc" ? va - vb : vb - va;
                });
            }

            // ---- JS PAGING ----
            totalCount = products.length;
            totalPages = Math.ceil(totalCount / pageSize);
            products = products.slice(skip, skip + pageSize);

        } else {
            // LOCAL ODATA
            if (totalCount === 0) {
                const allRes = await fetch(apiUrl);
                const allData = await allRes.json();
                const list = Array.isArray(allData) ? allData : allData.value;
                totalCount = list.length;
            }

            totalPages = Math.ceil(totalCount / pageSize);
        }

        // =====================
        // Hiển thị UI
        // =====================
        if (products.length === 0) {
            container.innerHTML = "<p>No products found.</p>";
            paginationWrap.innerHTML = "";
            return;
        }

        container.innerHTML = "";

        products.forEach(p => {
            const name = p.Title ?? p.title;
            const price = p.Price ?? p.price;
            const img = p.Images ?? p.images;
            const id = p.Id ?? p.id;

            const categoryName = p.Category?.Name ?? p.category?.name ?? "Unknown";

            const imgUrl = img?.startsWith("http")
                ? img
                : `assets/img/products/${img || "default.jpg"}`;

            const html = `
            <div class="col-lg-4 col-md-6 text-center">
                <div class="single-product-item">
                    <div class="product-image">
                        <a href="single-product.html?id=${id}">
                            <img src="${imgUrl}" alt="${name}">
                        </a>
                    </div>
                    <h3>${name}</h3>
                    <p class="product-price"><span>${categoryName}</span> $${price}</p>
                    <a href="cart.html" class="cart-btn"><i class="fas fa-shopping-cart"></i> Add to Cart</a>
                </div>
            </div>`;
            container.insertAdjacentHTML("beforeend", html);
        });

        renderPagination();

    } catch (err) {
        console.error("❌ Error:", err);
        container.innerHTML = '<p style="color:red;">Error loading product list.</p>';
    }
}

// =====================
// Pagination
// =====================
function renderPagination() {
    paginationWrap.innerHTML = "";

    const prevDisabled = page === 0 ? "disabled" : "";
    const nextDisabled = page + 1 >= totalPages ? "disabled" : "";

    paginationWrap.insertAdjacentHTML(
        "beforeend",
        `<li><a href="#" class="page-btn" data-page="${page - 1}" ${prevDisabled}>Prev</a></li>`
    );

    for (let i = 0; i < totalPages; i++) {
        const active = page === i ? "active" : "";
        paginationWrap.insertAdjacentHTML(
            "beforeend",
            `<li><a href="#" class="page-btn ${active}" data-page="${i}">${i + 1}</a></li>`
        );
    }

    paginationWrap.insertAdjacentHTML(
        "beforeend",
        `<li><a href="#" class="page-btn" data-page="${page + 1}" ${nextDisabled}>Next</a></li>`
    );

    document.querySelectorAll(".page-btn").forEach(btn => {
        btn.addEventListener("click", e => {
            e.preventDefault();
            const target = parseInt(btn.dataset.page);
            if (!isNaN(target) && target >= 0 && target < totalPages) {
                page = target;
                loadProducts();
                window.scrollTo({ top: 0, behavior: "smooth" });
            }
        });
    });
}

// =====================
// Search
// =====================
document.querySelector(".search-bar button").addEventListener("click", () => {
    currentKeyword = document.querySelector(".search-bar input").value.trim();
    page = 0;
    loadProducts();
});

document.querySelector(".search-bar input").addEventListener("keypress", e => {
    if (e.key === "Enter") {
        e.preventDefault();
        document.querySelector(".search-bar button").click();
    }
});

// =====================
// Sort
// =====================
const sortSelect = document.createElement("select");
sortSelect.innerHTML = `
<option value="">-- Sort by Product --</option>
<option value="Price asc">Price ↑</option>
<option value="Price desc">Price ↓</option>
<option value="Title asc">Name A–Z</option>
<option value="Title desc">Name Z–A</option>`;
sortSelect.classList.add("form-select", "mb-3");
sortSelect.style.width = "200px";
sortSelect.style.marginLeft = "10px";

const categorySortSelect = document.createElement("select");
categorySortSelect.innerHTML = `
<option value="">-- Sort by Category --</option>
<option value="asc">Category A–Z</option>
<option value="desc">Category Z–A</option>`;
categorySortSelect.classList.add("form-select", "mb-3");
categorySortSelect.style.width = "220px";
categorySortSelect.style.marginLeft = "10px";

const sortContainer = document.createElement("div");
sortContainer.style.display = "flex";
sortContainer.style.justifyContent = "flex-end";
sortContainer.style.marginBottom = "20px";
sortContainer.appendChild(categorySortSelect);
sortContainer.appendChild(sortSelect);
document.querySelector(".product-section .container").prepend(sortContainer);

sortSelect.addEventListener("change", () => {
    currentSort = sortSelect.value;
    currentCategorySort = "";
    categorySortSelect.value = "";
    page = 0;
    loadProducts();
});

categorySortSelect.addEventListener("change", () => {
    currentCategorySort = categorySortSelect.value;
    currentSort = "";
    sortSelect.value = "";
    page = 0;
    loadProducts();
});

// =====================
// INIT
// =====================
document.addEventListener("DOMContentLoaded", loadProducts);
</script>



</body>
</html>